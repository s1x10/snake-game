
<!DOCTYPE html>
<html>
    <head>
        <title>Snake Game</title>
        <style>
            canvas {
                border: 20px solid black;
            }
        </style>
    </head>
    <body>

        <div>
            <span>Points</span><span id="points" style="margin-left: 8px;">0</span>
            <button id="startGameButton" onclick="restartGame();">Start game</button>
        </div>
        <div>
            <label>Game size:</label>
            <!--<input onchange="resizeGame();" type="number" id="size" name="size" max="8" min="1" value="4">
            <br><br>-->
            <select onchange="resizeGame()" name="size" id="size" value="4">
            <option value=2>Little</option>
            <option value=3>Medium</option>
            <option value=4>Big</option>
            <option value=5>Very big</option>
            <option value=6>Massive</option>
            <br><br>
            </select>
        </div>
        <canvas id="snakegame" width="200px" height="200px"></canvas>
        <script>

            const canvas = document.querySelector("canvas");
            const ctx = canvas.getContext("2d")

            let isFirstRun = true
            let pointElement = document.getElementById("points")
            let frameRate = 1000 / 5;
            let squareSize = { x: 20, y: 20 }
            let food = {x: 2, y: 4}
            let points = 0
            let snake =
                [
                    {x: 10, y:10},
                    {x: 10, y:11},
                    {x: 10, y:12}]
            let speed = {x: 0, y: -1}
            let lastDirection = {x: 0, y: -1};
            let move = 
                [
                ]
            let isAlive = false


            function resizeGame(){
                if(isAlive === false) {

                    //console.log(document.getElementById("size"))
                    let size = parseInt(document.getElementById("size").value) * 10
                    canvas.width = squareSize.x * size
                    canvas.height = squareSize.y * size
                }else {
                    document.getElementById("size").innerHTML = "<option>can't change during game!</option>"
                }
            }

            resizeGame()


            function keydown() {
                document.addEventListener('keydown', (event) => {


                    if (event.key === "ArrowRight" && lastDirection.x !== -1) {
                        if (!move.includes(0)) {
                            move.push(0)
                        }
                    } else if (event.key === "ArrowLeft" && lastDirection.x !== 1) {
                        if (!move.includes(1)) {
                            move.push(1)
                        }
                    } else if (event.key === "ArrowUp" && lastDirection.y !== 1) {
                        if (!move.includes(2)) {
                            move.push(2)
                        }
                    } else if (event.key === "ArrowDown" && lastDirection.y !== -1) {
                        if (!move.includes(3)) {
                            move.push(3)
                        }
                    }

                })
            }

            function setPoint(value) {
                pointElement.innerText = value.toString();
            }
            
            function restartGame() {
                let canvasx = canvas.width
                let canvasy = canvas.height
                let cx = canvasx /= squareSize.x
                let cy = canvasy /= squareSize.y
                let cx2 = cx/2
                let cy2 = cy/2
                food = {x: 2, y: 4}
                points = 0
                snake = 
                    [{x: cx2, y:cy2},
                    {x: cx2, y:cy2 + 1},
                    {x: cx2, y:cy2 + 2}]
                speed = {x: 0, y: -1}
                lastDirection = {x: 0, y: -1};
                move =
                    [
                    ]
                isAlive = true
                setPoint(points)
            }

            
            function randomIntFromInterval(min, max) { // min and max included 
                return Math.floor(Math.random() * (max - min + 1) + min);
            }
            function playerDied() {
                //death logic
                isAlive = false
                console.log(isAlive)
                snake.splice(0, snake.length)
                snake.push(
                    {x: 10, y: 10},
                    {x: 10, y: 11},
                    {x: 10, y: 12}
                )
                move.splice(0, move.length)
                speed.x = 0;
                speed.y = 0;
                
                isFirstRun = false
                document.getElementById("startGameButton").innerText = "Restart game"
                document.getElementById("size").innerHTML = "<option value=2>Little</option>"
                document.getElementById("size").innerHTML += "<option value=3>Medium</option>"
                document.getElementById("size").innerHTML += "<option value=4>Big</option>"
                document.getElementById("size").innerHTML += "<option value=5>Very big</option>"
                document.getElementById("size").innerHTML += "<option value=6>Massive</option>"
            }
            function checkIfBad(){
                if (move[0] === 0 && move[1] === 1){
                    move[1] = null
                }
                if (move[0] === 1 && move[1] === 0){
                    move[1] = null
                }
                if (move[0] === 2 && move[1] === 3){
                    move[1] = null
                }
                if (move[0] === 3 && move[1] === 2) {
                    move[1] = null
                }
                
                if (move[1] === 0 && move[2] === 1){
                    move[2] = null
                }
                if (move[1] === 1 && move[2] === 0){
                    move[2] = null
                }
                if (move[1] === 2 && move[2] === 3){
                    move[2] = null
                }
                if (move[1] === 3 && move[2] === 2) {
                    move[2] = null
                }
                


                if(move.length >= 3){
                    move.pop()
                }
                console.log(move.length)
            }

            function gameLogic() {

                checkIfBad()
                
                if (move[0] === 0) {
                    speed.x = 1;
                    speed.y = 0;
                    lastDirection.x = 1;
                    lastDirection.y = 0;
                    
                    console.log("r")
                }
                if (move[0] === 1) {
                    speed.x = -1;
                    speed.y = 0;
                    lastDirection.x = -1;
                    lastDirection.y = 0;
                    
                    console.log("L")
                    
                }
                if (move[0] === 2) {
                    speed.x = 0;
                    speed.y = -1;
                    lastDirection.x = 0;
                    lastDirection.y = -1;
                    
                    console.log("U")
                }
                if (move[0] === 3) {
                    speed.x = 0;
                    speed.y = 1;
                    lastDirection.x = 0;
                    lastDirection.y = 1;
                    
                    
                    console.log("D")
                }
                keydown()
                //console.log(move[0])
                
                //console.log(move)
                move.shift()
                
                let nextPos = {

                    x: snake[0].x + speed.x,
                    y: snake[0].y + speed.y


                }
                if (food.x === nextPos.x && food.y === nextPos.y) {
                    snake.unshift(nextPos);
                    points += 1
                    setPoint(points)

                    food.x = randomIntFromInterval(0, 19)
                    food.y = randomIntFromInterval(0, 19)
                    let exists = snake.some(segment => segment.x === food.x && segment.y === food.y);
                    while (exists) {
                        food.x = randomIntFromInterval(0, 19)
                        food.y = randomIntFromInterval(0, 19)
                        exists = snake.some(segment => segment.x === food.x && segment.y === food.y);
                    }


                } else {
                    snake.unshift(nextPos);
                    snake.pop();

                }
                let segment = snake.slice(1).some(segment => segment.x === nextPos.x && segment.y === nextPos.y);
                
                let canvasx = canvas.width
                let canvasy = canvas.height
                let cx = canvasx /= squareSize.x
                let cy = canvasy /= squareSize.y
                if (segment || nextPos.x >= cx || nextPos.x < 0 || nextPos.y >= cy || nextPos.y < 0) {
                    playerDied();
                }
                

            }

            function logic() {
                if (isAlive) {
                    gameLogic()
                } else {
                }
            }
                

            function draw() {
                if (isAlive === true) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height)
                    ctx.fillStyle = "blue"
                    snake.forEach((part) => {
                        ctx.fillRect(
                            part.x * squareSize.x, 
                            part.y * squareSize.y, 
                            squareSize.x, 
                            squareSize.y)
                    });
                }
                ////ctx.createPattern()
                ctx.fillStyle = "red"
                ctx.fillRect(
                    food.x * squareSize.x, 
                    food.y * squareSize.y, 
                    squareSize.x,
                    squareSize.y);
            }

            function drawGameOver() {
                //ctx.fillRect(0, 0, canvas.width, canvas.height)
                ctx.fillStyle = "green"
                ctx.fillRect(100, 100, 400, 400)
            }
            function engine() {
                logic();
                draw();
                
            }
            
            let stop = setInterval(requestAnimationFrame, frameRate, engine)
            
        </script>
    </body>
</html>